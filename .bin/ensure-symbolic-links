#!/bin/zsh

_current_script_path="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# ------------------------------------------------
# UTILITY ----------------------------------------
# ------------------------------------------------
function _ensure_symbolic_link() {
  _sudo=false

  if [[ $1 == "--sudo" ]] ; then
    _sudo=true
    shift
  fi

  _source="$HOME/.configs/$1"
  _destination=$2

  if ! test -e $_source; then
    echo "fatal: Source '$_source' does not exist."
    exit 1
  fi

  # If the symbolic link already exists, remove
  # it and recreate.
  test -L $_destination && rm $_destination

  # If our destination is a directory, ensure the
  # paths so we can create the symlink within
  # them.
  if test -d $_destination; then
    test -d `dirname $_destination` || mkdir -p `dirname $_destination`
  fi

  ln -s $_source $_destination
}

# ------------------------------------------------
# ------------------------------------------------
# ------------------------------------------------
test -d /etc/zsh || sudo mkdir -p /etc/zsh
test -f /etc/zsh/colors || sudo ln -s $HOME/.configs/etc/zsh/colors /etc/zsh/colors

_ensure_symbolic_link zshrc ~/.zshrc
#_ensure_symbolic_link --sudo zshrc-shared /etc/zshrc-shared
_ensure_symbolic_link audio ~/.audio
#_ensure_symbolic_link oh-my-zsh ~/.oh-my-zsh

# ------------------------------------------------
# VIM --------------------------------------------
# ------------------------------------------------
_ensure_symbolic_link vim   ~/.vim
_ensure_symbolic_link vim   ~/.config/nvim
_ensure_symbolic_link vimrc ~/.vimrc
_ensure_symbolic_link vimrc ~/.config/nvim/init.vim

# ------------------------------------------------
# OTHER ------------------------------------------
# ------------------------------------------------
_ensure_symbolic_link tmux.conf ~/.tmux.conf

# ------------------------------------------------
# CALL-ROOT-HOOK-SCRIPT --------------------------
# ------------------------------------------------
sudo $_current_script_path/.bin/ensure-symbolic-links-root $HOME

